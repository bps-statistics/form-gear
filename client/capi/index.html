<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />

  <title>FormGear</title>
  <style>

    /*style*/

  </style>
  <!-- <link rel="stylesheet" href="https://unpkg.com/form-gear/dist/style.css"> -->
  <link rel="stylesheet" href="./data/style.css">
</head>

<body>
<noscript>You need to enable JavaScript to run this app.</noscript>

<div id="FormGear-loader" class="bg-gray-200  dark:bg-[#181f30]">

  <div class=" md:max-w-6xl mx-auto md:px-8 md:py-8">
    <div
      class="bg-gray-50 dark:bg-gray-900 dark:text-white text-gray-600 flex overflow-hidden text-sm font-montserrat rounded-lg shadow-xl dark:shadow-gray-800">
      
      
      <div class=" flex-grow flex flex-col bg-white dark:bg-gray-900 z-0">

        <div class="relative  md:flex   ">

          
          <div class="block">
            <div class=" backdrop-blur-sm col-span-12 overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none flex justify-center items-center">
              <img src="./src/assets/loading.png" alt="Loading..." class="w-20 h-20 animate-spin" loading="lazy" />   
            </div>
            <!-- <div class="col-span-12 overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none flex justify-center items-center text-center font-extralight text-xs">
              Mohon menunggu,<br> data sedang dalam proses
            </div> -->
          </div>

          <div
            class="bg-gray-50 dark:bg-gray-900 w-72 flex-shrink-0  dark:border-gray-800 h-full  p-5 space-y-4
            absolute inset-y-0 left-0 transform -translate-x-full transition-transform duration-500 ease-in-out md:relative md:translate-x-0 z-10">

            <div class="animate-pulse flex space-x-4">
              <div class="flex-1 space-y-3 py-1">
                <div class="w-full  shadow-2xl rounded-lg">

                  <div class="h-32 bg-gray-200 rounded-tr-lg rounded-tl-lg animate-pulse"></div>

                  <div class="p-5">
                    <div class="h-20 px-2 rounded-lg bg-gray-200 animate-pulse mb-4"></div>
                    <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-10 mb-4"></div>
                    <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>
                    <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>

                    <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-10 mb-4"></div>
                    <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>
                    <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>

                    <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-10 mb-4"></div>
                    <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>
                    <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>

                    <div class="h-20 px-2 rounded-lg bg-gray-200 animate-pulse mt-10 mb-4"></div>
                  </div>

                </div>
              </div>
            </div>

          </div>

          <div class="flex-grow bg-white dark:bg-gray-900 transition duration-500 ease-in-out z-10 p-5 space-y-4
            ">

            <div class="flex-grow bg-white dark:bg-gray-900 ">
              <div class=" w-full mx-auto">
                <div class="animate-pulse flex space-x-4">
                  <div class="flex-1 space-y-3 py-1">
                    <div
                      class="min-h-screen flex items-start justify-start bg-gradient-to-br from-gray-200 to-gray-400">
          
                      <div class="w-full bg-white  shadow-2xl rounded-lg">

                        <div class="h-32 bg-gray-200 rounded-tr-lg rounded-tl-lg animate-pulse"></div>

                        <div class="p-5">
                          <div class="h-20 px-2 rounded-lg bg-gray-200 animate-pulse mb-4"></div>
                          <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-10 mb-4"></div>
                          <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>
                          <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>

                          <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-10 mb-4"></div>
                          <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>
                          <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>

                          <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-10 mb-4"></div>
                          <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>
                          <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>

                          <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-10 mb-4"></div>
                          <div class="h-6 rounded-lg bg-gray-200 animate-pulse mt-4 mb-4"></div>
                        </div>

                      </div>

                    </div>

                  </div>
                </div>
              </div>
            </div>

          </div>



        </div>

      </div>
    </div>
  </div>

</div>

<div id="FormGear-root"></div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script type="module">
  //formgear_js
  // import { FormGear } from 'https://unpkg.com/form-gear/dist/form-gear.es.js'
  import { FormGear } from './data/form-gear.es.js'

  let config = {
    clientMode : 2,
    token : ``,
    baseUrl : ``,
    lookupKey: `keys`,
    lookupValue: `values`,  
    lookupMode : 2, // 1 => ONLINE ; 2 => OFFLINE
    // username : Android.getUserName(),
    username : 'styd',
    formMode: 1, // 1 => OPEN ; 2 => REVIEW ; 3 => CLOSE ;
    initialMode: 2 // 1=> INITIAL ; 2 => ASSIGN
  }

  var responseGear = null;
  var remarkGear = null;
  var principalGear = null;
  var referenceGear = null;

  function openCamera() {
      window.Android.action("CAMERA", "", "", "");
      console.log('open camera');
  }

  function openCameraGPS(needPhoto) {
    var isNeedPhoto = false
    if (needPhoto !== null && needPhoto !== undefined)
      isNeedPhoto = needPhoto
    console.log("new-capi: open-camera-gps " + isNeedPhoto.toString())

    window.Android.action("CAMERA_GPS", "", isNeedPhoto.toString(), "");
  }

  let uploadHandler = function(setValue) {
        console.log('camera handler', setValue  );
        cameraFunction = setValue;
        openCamera();
  }

  let offlineSearch = function (id, version, dataJson, setter) {
    console.log("coba lookup");
    // let id = '1174c3bf-9ffa-4a43-9649-75f4cf3b706b';
    // let version = 'v1';
    // const dataJson = [
    //                   {"key" : "kdprov",
    //                   "value" : "11"},
    //                   {"key" : "kdprov",
    //                   "value" : "12"}
                      
    let condition = JSON.stringify(dataJson)

    console.log('kondisinnya : ' , condition);

    $.ajax({
        url: `http://localhost:9090/lookup?id=${id}&v=${version}&c=${condition}`,
                type: "GET",
                crossDomain: true,
                dataType: "json",
                data: null,
            success: function(d) {
                console.log(d.hasil)
                setter(d)

            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {

            }
        });
  }

  let GpsHandler = function(setter, isPhoto) {
    console.log('camera handler', setter);
    isPhoto = false,
    cameraGPSFunction = setter;
    openCameraGPS(isPhoto);
  }

  const setBearer = () => {
    return ({
        method: 'GET',
        headers: {
            "Content-Type": "application/json"
        }
    })
  }

  let mobileExit = (fun) => {
    fun()
  }

  // pencarian online
  let onlineSearch = async (url) =>
  (await fetch(url, setBearer())
    .catch((error) => {
      return {
        success: false,
        data: {},
        message: '500'
      }
    }).then((res) => {
      if (res.status === 200) {
        let temp = res.json();
        return temp;
      } else {
        return {
          success: false,
          data: {},
          message: res.status
        }
      }
    }).then((res) => {
      return res;
  }));

  let setResponseMobile = function (res, rem, princ, ref) {
    responseGear = res
    remarkGear = rem
    principalGear = princ
    referenceGear = ref

    console.log('response save', responseGear)
    console.log('remark save', remarkGear)
    console.log('principal save', principalGear)
    console.log('reference save', referenceGear)

    window.Android.action("SAVE_RESPONSE", "", JSON.stringify(responseGear), "");
    window.Android.action("SAVE_REMARK", "", JSON.stringify(remarkGear), "");
    window.Android.action("SAVE_PRINCIPAL", "", JSON.stringify(principalGear), "");
    window.Android.action("SAVE_REFERENCE", "", JSON.stringify(referenceGear), "");

  }

  let setSubmitMobile = function (res, rem, princ, ref) {
    responseGear = res
    remarkGear = rem
    principalGear = princ
    referenceGear = ref

    console.log('response submit', responseGear)
    console.log('remark submit', remarkGear)
    console.log('principal submit', principalGear)
    console.log('reference submit', referenceGear)

    window.Android.action("SUBMIT_RESPONSE", "", JSON.stringify(responseGear), "");
    window.Android.action("SUBMIT_REMARK", "", JSON.stringify(remarkGear), "");
    window.Android.action("SUBMIT_PRINCIPAL", "", JSON.stringify(principalGear), "");
    window.Android.action("SUBMIT_REFERENCE", "", JSON.stringify(referenceGear), "");

  }


  let openMap = function(koordinat) {
      window.Android.action("OPEN_MAPS", "", JSON.stringify(koordinat), "");
  }

  function saveData() {
      window.Android.action("SAVE_DATA", "", JSON.stringify(setResponseMobile), "");
  }

  const data = Promise.all([    
                  fetch("./data/reference.json").then((res) => res.json()).catch((error) => {return {}}) || [],
                  fetch("./data/template.json").then((res) => res.json()).catch((error) => {return {}}) || [],
                  fetch("./data/preset.json").then((res) => res.json()).catch((error) => {return {}}) || [],
                  fetch("./data/response.json").then((res) => res.json()).catch((error) => {return {}}) || [],
                  fetch("./data/validation.json").then((res) => res.json()).catch((error) => {return {}}) || [],
                  fetch("./data/remark.json").then((res) => res.json()).catch((error) => {return {}}) || []
                  // JSON.parse(Android.getReference()),
                  // JSON.parse(Android.getTemplate()),
                  // JSON.parse(Android.getPreset()),
                  // JSON.parse(Android.getResponse()),
                  // JSON.parse(Android.getValidation()),
                  // JSON.parse(Android.getRemark())
           ]);

  data.then(([reference, template, preset, response, validation, remark]) => initForm(reference, template, preset, response, validation, remark));

  function initForm(reference, template, preset, response, validation, remark){

      let form = new FormGear(reference, template, preset, response, validation, remark, config, uploadHandler, GpsHandler, offlineSearch, onlineSearch, mobileExit, setResponseMobile, setSubmitMobile, openMap);

      return form;
  }

</script>

<script type="text/javascript">
  let cameraFunction = null;
  let cameraGPSFunction = null;

  function result(action, result, customData) {
      if (action == "GET_LOC") {
          resultGps(result);
      } else if (action == "CAMERA") {
          resultCamera(result);
      } else if (action == "CAMERA_GPS") {
          resultCameraGPS(result);
      } else if (action == "SIGNATURE") {
          resultSignature(result);
      } else if (action == "BARCODE") {
          resultBarcode(result);
      } else if (action == "AUDIO") {
          resultAudio(result);
      } else if (action == "GET_ANSWER") {
          resultAnswer(result, customData);
      } else if (action == "LOOKUP") {
          resultAnswer(result, customData);
      }
  }

  function resultCamera(result) {
      if (cameraFunction != null) {
        cameraFunction(result);
      } else {
        console.log('camera_result_funcion : null');
      }
  }

  function resultCameraGPS(result) {
      const obj = JSON.parse(result);
      var remark = obj.remark;
      cameraGPSFunction(obj, remark);
  }
  
</script>

</body>

</html>